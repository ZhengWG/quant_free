# 产品设计文档 (PRD)

## 1. 项目概述

### 1.1 项目名称
**QuantFree - VSCode股票交易助手**

### 1.2 项目定位
一款集成在VSCode编辑器中的股票交易管理插件，为开发者提供实时行情查看、AI驱动的交易策略推荐和自动化交易执行功能。

### 1.3 目标用户
- 量化交易开发者
- 股票投资者（有编程背景）
- 金融数据分析师

### 1.4 核心价值
- **便捷性**：在编码环境中直接管理股票交易，无需切换应用
- **智能化**：基于大模型的策略推荐，辅助投资决策
- **自动化**：支持策略回测和自动化交易执行

## 2. 市场调研与竞品分析

### 2.1 参考项目

#### 2.1.1 韭菜盒子 (Leek-Fund)
- **功能**：VSCode插件，支持查看股票、基金、期货实时数据
- **特点**：实时涨跌显示、走势图、基金排行榜、持仓信息
- **参考价值**：UI设计、数据展示方式、VSCode插件开发模式

#### 2.1.2 天勤VSCode插件
- **功能**：策略运行、日志保存、K线图显示
- **特点**：量化交易策略开发环境
- **参考价值**：策略执行框架、K线图可视化

#### 2.1.3 FinRL
- **功能**：基于深度强化学习的自动化股票交易框架
- **特点**：策略生成、回测、实盘交易
- **参考价值**：AI策略生成技术、交易执行框架

### 2.2 差异化优势
1. **AI策略推荐**：集成大模型（GPT/Claude等），提供个性化策略建议
2. **一体化交易**：从看盘到策略到交易，全流程在VSCode中完成
3. **开发者友好**：支持策略代码编辑、回测、调试

## 3. 功能需求

### 3.1 核心功能模块

#### 3.1.1 实时行情监控模块
**功能描述**：
- 在VSCode侧边栏显示自选股票列表
- 实时更新价格、涨跌幅、成交量等数据
- 支持A股、港股、美股、基金、期货等多市场

**详细功能**：
- ✅ 自选股管理（添加/删除/分组）
- ✅ 实时价格刷新（可配置刷新频率）
- ✅ 涨跌幅颜色标识（红涨绿跌）
- ✅ 快速查看详情（点击查看K线图）
- ✅ 价格提醒设置（涨跌到目标价提醒）
- ✅ 市场指数显示（上证、深证、创业板等）

**UI设计**：
```
侧边栏面板：
┌─────────────────────────┐
│ 📈 实时行情              │
├─────────────────────────┤
│ 🔍 搜索股票              │
├─────────────────────────┤
│ 自选股列表：             │
│ ┌─────────────────────┐ │
│ │ 000001 平安银行      │ │
│ │ 价格: 12.50 ↑2.5%   │ │
│ │ 成交量: 1.2亿        │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ 600519 贵州茅台      │ │
│ │ 价格: 1850.00 ↓1.2% │ │
│ │ 成交量: 5000万       │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

#### 3.1.2 AI策略推荐模块
**功能描述**：
- 集成大模型API（OpenAI/Claude/本地模型）
- 基于市场数据和技术指标生成交易策略
- 提供买入/卖出建议、目标价位、止损位等

**详细功能**：
- ✅ 策略生成（基于当前市场数据）
- ✅ 策略解释（AI说明推荐理由）
- ✅ 策略评分（风险等级、预期收益）
- ✅ 历史策略回测（查看历史推荐表现）
- ✅ 自定义策略参数（风险偏好、持仓周期等）
- ✅ 策略保存与分享

**工作流程**：
1. 用户选择股票或输入股票代码
2. 插件收集相关市场数据（价格、成交量、技术指标等）
3. 调用大模型API，传入市场数据和用户偏好
4. 大模型分析并生成策略建议
5. 在UI中展示策略详情和解释

**提示词模板示例**：
```
你是一位专业的量化交易策略分析师。请基于以下市场数据，生成交易策略建议：

股票代码：{code}
当前价格：{price}
技术指标：{indicators}
市场趋势：{trend}
用户风险偏好：{risk_level}

请提供：
1. 买入/卖出/持有建议
2. 目标价位
3. 止损位
4. 持仓周期建议
5. 策略理由说明
```

#### 3.1.3 交易执行模块
**功能描述**：
- 通过券商API执行实际交易
- 支持买入、卖出、撤单等操作
- 查看持仓、订单状态、交易记录

**详细功能**：
- ✅ 快速下单（市价单/限价单）
- ✅ 批量下单
- ✅ 撤单功能
- ✅ 持仓查询
- ✅ 订单查询（历史订单、未成交订单）
- ✅ 账户信息（资金余额、可用资金）
- ✅ 交易记录导出

**安全机制**：
- 交易前二次确认
- 交易密码验证
- 操作日志记录
- 异常交易预警

**支持的券商API**：
- 同花顺API
- 东方财富API
- 雪球API
- 自定义API接口

#### 3.1.4 数据可视化模块
**功能描述**：
- K线图展示
- 技术指标图表
- 资金流向分析
- 策略回测结果可视化

**详细功能**：
- ✅ K线图（日K、周K、月K）
- ✅ 技术指标叠加（MA、MACD、KDJ等）
- ✅ 成交量柱状图
- ✅ 资金流向图
- ✅ 策略收益曲线
- ✅ 回测报告图表

#### 3.1.5 策略回测模块
**功能描述**：
- 基于历史数据测试策略有效性
- 计算收益率、夏普比率等指标
- 生成回测报告

**详细功能**：
- ✅ 历史数据获取
- ✅ 策略回测执行
- ✅ 回测指标计算（收益率、最大回撤、胜率等）
- ✅ 回测报告生成
- ✅ 策略对比分析

### 3.2 辅助功能模块

#### 3.2.1 通知提醒模块
- 价格提醒（涨跌到目标价）
- 策略信号提醒（AI推荐新策略）
- 交易执行提醒（订单成交、撤单成功等）
- 系统通知（VSCode通知中心）

#### 3.2.2 数据管理模块
- 本地数据缓存
- 历史数据存储
- 策略记录保存
- 交易记录备份

#### 3.2.3 配置管理模块
- 账户配置（交易账户、API密钥）
- 大模型配置（API密钥、模型选择）
- 数据源配置（行情数据源选择）
- 界面配置（刷新频率、颜色主题）

## 4. 技术架构

### 4.1 技术栈选型

#### 前端（VSCode插件）
- **语言**：TypeScript
- **UI框架**：React + VSCode Webview API
- **图表库**：ECharts / Chart.js
- **状态管理**：Redux / Zustand

#### 后端服务
- **运行时**：Node.js
- **框架**：Express / Fastify
- **数据库**：SQLite（本地存储）
- **缓存**：Redis（可选）

#### 外部服务集成
- **行情数据**：
  - Tushare（A股数据）
  - Alpha Vantage（美股数据）
  - 腾讯财经API
  - 新浪财经API
- **大模型API**：
  - OpenAI GPT-4
  - Anthropic Claude
  - 本地模型（Ollama）
- **交易API**：
  - 券商API（同花顺、东方财富等）
  - 模拟交易API（用于测试）

### 4.2 数据流设计

```
用户操作 → VSCode插件 → 后端服务 → 外部API
                ↓
           本地缓存/数据库
```

## 5. 用户界面设计

### 5.1 主界面布局

```
┌─────────────────────────────────────────────┐
│ VSCode编辑器                                 │
│ ┌──────────┐ ┌──────────────────────────┐  │
│ │          │ │                          │  │
│ │  代码    │ │     QuantFree插件面板     │  │
│ │  编辑    │ │                          │  │
│ │  区      │ │  ┌────────────────────┐  │  │
│ │          │ │  │ 实时行情           │  │  │
│ │          │ │  ├────────────────────┤  │  │
│ │          │ │  │ AI策略推荐         │  │  │
│ │          │ │  ├────────────────────┤  │  │
│ │          │ │  │ 交易执行           │  │  │
│ │          │ │  └────────────────────┘  │  │
│ └──────────┘ └──────────────────────────┘  │
└─────────────────────────────────────────────┘
```

### 5.2 状态栏集成
在VSCode状态栏显示：
- 主要指数涨跌幅（上证指数、深证成指）
- 账户总资产
- 今日盈亏

### 5.3 命令面板集成
- `QuantFree: 添加自选股`
- `QuantFree: 生成策略推荐`
- `QuantFree: 查看持仓`
- `QuantFree: 快速下单`
- `QuantFree: 打开K线图`

## 6. 安全性设计

### 6.1 数据安全
- **加密存储**：账户信息、API密钥使用加密存储
- **传输加密**：所有API调用使用HTTPS
- **本地存储**：敏感数据存储在VSCode安全存储中

### 6.2 交易安全
- **二次确认**：所有交易操作需要用户确认
- **密码验证**：关键操作需要交易密码
- **限额控制**：可设置单笔/单日交易限额
- **异常检测**：检测异常交易行为并预警

### 6.3 日志审计
- 记录所有交易操作
- 记录API调用日志
- 记录用户操作日志
- 支持日志导出和审计

## 7. 性能要求

### 7.1 响应时间
- 行情数据刷新：< 1秒
- 策略生成：< 5秒
- 交易执行：< 2秒

### 7.2 资源占用
- 内存占用：< 200MB
- CPU占用：< 5%（空闲时）

### 7.3 并发支持
- 支持多股票同时监控
- 支持批量交易操作

## 8. 开发计划

### 8.1 第一阶段（MVP - 最小可行产品）
- ✅ 基础VSCode插件框架
- ✅ 实时行情查看（单市场）
- ✅ 基础策略推荐（简单规则）
- ✅ 模拟交易功能

### 8.2 第二阶段
- ✅ AI策略推荐集成
- ✅ 实盘交易API对接
- ✅ K线图可视化
- ✅ 策略回测功能

### 8.3 第三阶段
- ✅ 多市场支持
- ✅ 高级技术指标
- ✅ 策略优化
- ✅ 性能优化

## 9. 风险评估

### 9.1 技术风险
- **API稳定性**：依赖第三方API，可能存在不稳定情况
  - **应对**：多数据源备份、本地缓存
- **大模型成本**：API调用成本较高
  - **应对**：支持本地模型、请求缓存

### 9.2 合规风险
- **交易合规**：需要确保符合证券交易法规
  - **应对**：仅提供工具，不提供投资建议，用户自行承担风险

### 9.3 安全风险
- **账户安全**：交易账户信息泄露风险
  - **应对**：加密存储、最小权限原则

## 10. 成功指标

### 10.1 用户指标
- 插件安装量：> 1000
- 日活跃用户：> 100
- 用户留存率：> 30%

### 10.2 功能指标
- 策略推荐准确率：> 60%
- 交易执行成功率：> 99%
- 系统稳定性：> 99.5%

## 11. 后续规划

### 11.1 功能扩展
- 支持更多市场（加密货币、期货等）
- 支持更多技术指标
- 支持策略模板市场
- 支持社区分享

### 11.2 技术优化
- 性能优化
- 用户体验优化
- 移动端支持（VSCode Mobile）

---

**文档版本**：v1.0  
**最后更新**：2025年  
**维护者**：ZhengWG

